{"ip":"176.222.55.126"}root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# bash mikrotik-fix.
mikrotik-fix.rsc  mikrotik-fix.sh
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# bash mikrotik-fix.sh
Resolving current API IP address...
api.ipify.org currently resolves to 104.26.13.205
Configuring VPN server...
net.ipv4.ip_forward = 1
Error: Nexthop has invalid gateway.
Configuring NAT rules...
Generating MikroTik configuration...
Configuration saved to mikrotik-commands.rsc

===== Setup Complete =====
1. Apply the MikroTik commands from the file ONE BY ONE:
   - Connect to your MikroTik router
   - Copy and paste each command separately

2. Restart OpenVPN with: sudo systemctl restart openvpn

3. Test the connection with: curl http://api.ipify.org?format=json

Your API traffic should now go through the MikroTik router's IP.
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# curl http://api.ipify.org?format=json
{"ip":"176.222.55.126"}root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting#

API_IP=$(host -t A api.ipify.org | grep "has address" | head -n1 | awk '{print $NF}')
IP: $API_IP"root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# echo "API IP: $API_IP"
API IP: 104.26.12.205


ing# ip route show table apiroutes
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting#


Routing# ip rule show | grep -E "(api|$API_IP)"
32765:  from all to 104.26.13.205 lookup apiroutes
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting#


Routing# ip route get $API_IP
104.26.12.205 via 176.222.55.1 dev ens1 src 176.222.55.126 uid 0
    cache

root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting#
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# echo "200 apiroutes" >> /etc/iproute2/rt_tables
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# grep apiroutes /etc/iproute2/rt_tables
200 apiroutes
200 apiroutes
200 apiroutes
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting#





# API_IP=$(host -t A api.ipify.org | grep "has address" | head -n1 | awk '{print $NF}')
IP: $API_IP"root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# echo "API IP: $API_IP"
API IP: 104.26.12.205
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting#
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting#
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting#
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting#
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting#
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# ip route show table apiroutes
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# ip rule show | grep -E "(api|$API_IP)"
32765:  from all to 104.26.13.205 lookup apiroutes
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# ip route get $API_IP
104.26.12.205 via 176.222.55.1 dev ens1 src 176.222.55.126 uid 0
    cache
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting#
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting#
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# echo "200 apiroutes" >> /etc/iproute2/rt_tables
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# grep apiroutes /etc/iproute2/rt_tables
200 apiroutes
200 apiroutes
200 apiroutes
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# ip rule add to api.ipify.org lookup apiroutes
Error: any valid prefix is expected rather than "api.ipify.org".
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# ip rule add to $API_IP lookup apiroutes
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# ip route add $API_IP/32 via 10.8.0.6 table apiroutes
Error: Nexthop has invalid gateway.
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# ip route flush cache
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# iptables -t nat -F PREROUTING
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# iptables -t nat -F POSTROUTING
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# API_IP=$(host -t A api.ipify.org | grep "has address" | head -n1 | awk '{print $NF}')
TERNAL_IP="10.8.0.1"root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# MIKROTIK_VPN_IP="10.8.0.6"
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting# VPN_SERVER_INTERNAL_IP="10.8.0.1"
root@itguy-Zeroxbit:/home/itguy/vpn/OpenVpn-Server/apiRouting#









oTik] > /ip forward enable
bad command name forward (line 1 column 5)
[admin@MikroTik] > /ip route add dst-address=104.26.12.205/32 gateway=10.8.0.1 distance=1
[admin@MikroTik] > /ip firewall nat add chain=srcnat src-address=10.8.0.1 dst-address=104.26.12.205 action=masquerade comment="API Traffic NAT"
[admin@MikroTik] > /ip dns static add name=api.ipify.org address=104.26.12.205 comment="API DNS entry"
failure: entry already exists
[admin@MikroTik] > 
